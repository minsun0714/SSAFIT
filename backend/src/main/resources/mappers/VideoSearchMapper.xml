<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.ssafit.dao.VideoSearchMapper">
    <!-- 비디오 검색 쿼리 -->
    <select id="searchVideos" resultType="Video">
        SELECT
        video_id,
        channel_title,
        title,
        view_count,
        published_at,
        part,
        video_status
        FROM video
        WHERE title LIKE CONCAT('%', #{keyword}, '%') AND video_status = 'APPROVED'
        ORDER BY
        <choose>
            <when test="sortType == 'RECENT'">
                published_at DESC
            </when>
            <when test="sortType == 'VIEW_CNT'">
                view_count DESC
            </when>
            <otherwise>
                created_at DESC
            </otherwise>
        </choose>
        LIMIT #{size} OFFSET #{offset}
    </select>

    <!-- 비디오 총 개수 조회 -->
    <select id="countVideos" resultType="int">
        SELECT COUNT(*)
        FROM video
        WHERE title LIKE CONCAT('%', #{keyword}, '%') AND video_status = 'APPROVED'
    </select>

    <!-- 자동완성 -->
    <select id="getAutocompleteSuggestions" resultType="String">
        SELECT title
        FROM video
        WHERE title LIKE CONCAT('%', #{keyword}, '%') AND video_status = 'APPROVED'
        LIMIT #{limit}
    </select>
</mapper>
